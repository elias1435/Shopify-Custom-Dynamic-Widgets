{% comment %}
  Product Details Widget â€” Static or Product-powered
  - Width: container (.page-width) or full
  - Background: solid or gradient (angle uses 0â€“100 slider â†’ 0â€“360deg)
  - Right column can pull product image/title/price when source = "product"
  - Independent bg colors for left included box and right media box
  - All font sizes are configurable
{% endcomment %}

{%- comment -%} Determine if we should pull data from a product {%- endcomment -%}
{% assign use_product = false %}
{% if section.settings.source == 'product' and section.settings.product != blank %}
  {% assign use_product = true %}
  {% assign pd_product = section.settings.product %}
  {% assign pd_img = pd_product.featured_image %}
  {% assign pd_title = pd_product.title %}
  {% assign pd_price = pd_product.price | money %}
{% endif %}

<section
  id="product-details-{{ section.id }}"
  class="product-details-widget"
  data-layout="{{ section.settings.layout }}"
  style="
    {% if section.settings.bg_type == 'solid' %}
      --pdw-bg: {{ section.settings.bg_solid }};
    {% else %}
      {% assign _angle_deg = section.settings.grad_angle | times: 3.6 | round: 1 %}
      --pdw-bg: {{ section.settings.grad_type }}-gradient({{ _angle_deg }}deg, {{ section.settings.grad_start_color }} {{ section.settings.grad_start_pos }}%, {{ section.settings.grad_end_color }} {{ section.settings.grad_end_pos }}%);
    {% endif %}

    /* colors */
    --pdw-title-color: {{ section.settings.title_color }};
    --pdw-subtitle-color: {{ section.settings.subtitle_color }};
    --pdw-body-color: {{ section.settings.body_color }};
    --pdw-badge-bg: {{ section.settings.badge_bg }};
    --pdw-badge-text: {{ section.settings.badge_text }};
    --pdw-included-bg: {{ section.settings.included_bg }};
    --pdw-media-bg: {{ section.settings.media_bg }};
    --pdw-card-grad-start: {{ section.settings.card_grad_start }};
    --pdw-card-grad-end: {{ section.settings.card_grad_end }};
    --pdw-price-color: {{ section.settings.price_color }};
    --pdw-muted: {{ section.settings.muted_color }};

    /* radii/shadows/spacing */
    --pdw-card-radius: {{ section.settings.card_radius }}px;
    --pdw-card-shadow: {% if section.settings.card_shadow %}0 10px 30px rgba(0,0,0,.06){% else %}none{% endif %};
    --pdw-pad-t: {{ section.settings.pad_t }}px;
    --pdw-pad-b: {{ section.settings.pad_b }}px;
    --pdw-pad-x: {{ section.settings.pad_x }}px;

    /* font sizes */
    --fs-title: {{ section.settings.title_size }}px;
    --fs-subtitle: {{ section.settings.subtitle_size }}px;
    --fs-heading: {{ section.settings.heading_size }}px;
    --fs-body: {{ section.settings.body_size }}px;
    --fs-included-title: {{ section.settings.included_title_size }}px;
    --fs-badge: {{ section.settings.badge_size }}px;
    --fs-caption: {{ section.settings.card_caption_size }}px;
    --fs-price: {{ section.settings.price_size }}px;
    --fs-ship: {{ section.settings.shipping_size }}px;
   
    /* product CTA */
    --cta-bg: {{ section.settings.cta_bg }};
    --cta-text: {{ section.settings.cta_text }};
    --cta-hover-bg: {{ section.settings.cta_hover_bg }};
    --cta-hover-text: {{ section.settings.cta_hover_text }};
    --cta-border-color: {{ section.settings.cta_border_color }};
    --cta-border-width: {{ section.settings.cta_border_width }}px;
    --cta-radius: {{ section.settings.cta_radius }}px;
    --cta-shadow: {% if section.settings.cta_shadow %}0 6px 18px rgba(0,0,0,.12){% else %}none{% endif %};
    --cta-font-size: {{ section.settings.cta_font_size }}px;
    --cta-py: {{ section.settings.cta_pad_y }}px;
    --cta-px: {{ section.settings.cta_pad_x }}px;
  "
>
  <div class="{% if section.settings.width == 'container' %}page-width{% else %}full-width{% endif %}" style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;">
    <div class="pdw-inner">
      <!-- Top title + subtitle -->
      <div class="pdw-intro">
        {% if section.settings.title != blank %}
          <h2 class="pdw-title">{{ section.settings.title }}</h2>
        {% endif %}
        {% if section.settings.subtitle != blank %}
          <p class="pdw-subtitle">{{ section.settings.subtitle }}</p>
        {% endif %}
      </div>

      <!-- Grid -->
      <div class="pdw-grid">
        <!-- Left column -->
        <div class="pdw-left">
          <!-- Badges -->
          <div class="pdw-badges">
            {% if section.settings.badge_1 != blank %}
              <span class="pdw-badge pdw-badge--filled">{{ section.settings.badge_1 }}</span>
            {% endif %}
            {% if section.settings.badge_2 != blank %}
              <span class="pdw-badge pdw-badge--outline">{{ section.settings.badge_2 }}</span>
            {% endif %}
          </div>

          {% if section.settings.heading != blank %}
            <h3 class="pdw-heading">{{ section.settings.heading }}</h3>
          {% endif %}
          {% if section.settings.body != blank %}
            <p class="pdw-body">{{ section.settings.body }}</p>
          {% endif %}

          <!-- What's included -->
          <div class="pdw-included">
            {% if section.settings.included_title != blank %}
              <h4 class="pdw-included-title">{{ section.settings.included_title }}</h4>
            {% endif %}
            {% if section.blocks.size > 0 %}
              <ul class="pdw-included-list">
                {% for block in section.blocks %}
                  {% if block.type == 'included' %}
                    <li {{ block.shopify_attributes }}>
                      <span class="pdw-dot">â€¢</span>
                      <span class="pdw-included-text">{{ block.settings.text }}</span>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>

        <!-- Right column (card) -->
        <div class="pdw-right">
          <div class="pdw-card">
            <div class="pdw-media" style="height: {{ section.settings.media_height }}px;">
              {%- if use_product and pd_img != blank -%}
                <img
                  srcset="
                    {{ pd_img | image_url: width: 400 }} 400w,
                    {{ pd_img | image_url: width: 800 }} 800w,
                    {{ pd_img | image_url: width: 1200 }} 1200w
                  "
                  sizes="(min-width: 990px) 540px, 100vw"
                  src="{{ pd_img | image_url: width: 800 }}"
                  alt="{{ pd_title | escape }}"
                  loading="lazy"
                  class="pdw-img"
                >
              {%- elsif section.settings.image != blank -%}
                {%- assign img = section.settings.image -%}
                <img
                  srcset="
                    {{ img | image_url: width: 400 }} 400w,
                    {{ img | image_url: width: 800 }} 800w,
                    {{ img | image_url: width: 1200 }} 1200w
                  "
                  sizes="(min-width: 990px) 540px, 100vw"
                  src="{{ img | image_url: width: 800 }}"
                  alt="{{ section.settings.image_alt | escape }}"
                  loading="lazy"
                  class="pdw-img"
                >
              {%- else -%}
                <span class="pdw-emoji">ðŸª‘</span>
              {%- endif -%}
            </div>
            <div class="pdw-card-meta">
              <p class="pdw-card-caption">
                {%- if use_product -%}
                  {{ pd_title }}
                {%- else -%}
                  {{ section.settings.card_caption }}
                {%- endif -%}
              </p>
              <p class="pdw-price">
                {%- if use_product -%}
                  {{ pd_price }}
                {%- else -%}
                  {{ section.settings.price }}
                {%- endif -%}
              </p>

              {%- if use_product -%}
                <a class="pdw-cta" href="{{ pd_product.url }}">
                    {{ 'products.product.add_to_cart' | t | default: 'View product' }}
                </a>
                {%- else -%}
                {%- if section.settings.cta_label != blank and section.settings.cta_url != blank -%}
                    <a class="pdw-cta" href="{{ section.settings.cta_url }}"
                    {% if section.settings.cta_newtab %}target="_blank" rel="noopener"{% endif %}>
                    {{ section.settings.cta_label }}
                    </a>
                {%- endif -%}
               {%- endif -%}

              {% if section.settings.shipping_note != blank %}
                <p class="pdw-shipping">{{ section.settings.shipping_note }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    #product-details-{{ section.id }} { background: var(--pdw-bg); padding: var(--pdw-pad-t) var(--pdw-pad-x) var(--pdw-pad-b); }
    #product-details-{{ section.id }} .pdw-inner { margin: 0 auto; }
    #product-details-{{ section.id }} .pdw-intro { text-align: center; margin-bottom: 2.5rem; }
    #product-details-{{ section.id }} .pdw-title {
      color: var(--pdw-title-color); font-size: clamp(26px, 4vw, var(--fs-title)); font-weight: 800; margin: 0 0 .5rem; line-height: 1.15;
    }
    #product-details-{{ section.id }} .pdw-subtitle {
      color: var(--pdw-subtitle-color); font-size: clamp(14px, 2vw, var(--fs-subtitle)); max-width: 60ch; margin: 0 auto; line-height: 1.6;
    }

    /* base grid */
    #product-details-{{ section.id }} .pdw-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    align-items: center;
    }

    /* areas for desktop */
    #product-details-{{ section.id }} .pdw-left { grid-area: left; }
    #product-details-{{ section.id }} .pdw-right { grid-area: right; }

    #product-details-{{ section.id }} .pdw-grid { display: grid; grid-template-columns: 1fr; gap: 3rem; align-items: center; }
    @media (min-width: 768px) {

    #product-details-{{ section.id }} .pdw-grid { grid-template-columns: 1fr 1fr; }
    
    #product-details-{{ section.id }} .pdw-grid {
        grid-template-columns: 1fr 1fr;
        grid-template-areas: "left right";
    }

    /* swap when selected */
    #product-details-{{ section.id }}[data-layout="text-right"] .pdw-grid {
        grid-template-areas: "right left";
    }
    
    }

    #product-details-{{ section.id }} .pdw-badges { display: flex; gap: .75rem; margin-bottom: 1rem; flex-wrap: wrap; }
    #product-details-{{ section.id }} .pdw-badge { display: inline-flex; align-items: center; border-radius: 999px; padding: .5rem 1rem; font-weight: 600; border: 1px solid transparent; font-size: var(--fs-badge); }
    #product-details-{{ section.id }} .pdw-badge--filled { background: var(--pdw-badge-bg); color: var(--pdw-badge-text); }
    #product-details-{{ section.id }} .pdw-badge--outline { color: var(--pdw-title-color); background: transparent; border-color: color-mix(in oklab, var(--pdw-title-color) 16%, transparent); }

    #product-details-{{ section.id }} .pdw-heading { font-size: clamp(18px, 3.2vw, var(--fs-heading)); font-weight: 700; color: var(--pdw-title-color); margin: .25rem 0 .75rem; }
    #product-details-{{ section.id }} .pdw-body { color: var(--pdw-body-color); font-size: clamp(14px, 2vw, var(--fs-body)); line-height: 1.65; margin: 0 0 1rem; }

    #product-details-{{ section.id }} .pdw-included { background: var(--pdw-included-bg); padding: 1.25rem; border-radius: 12px; }
    #product-details-{{ section.id }} .pdw-included-title { color: var(--pdw-title-color); font-weight: 600; font-size: var(--fs-included-title); margin: 0 0 .75rem; }
    #product-details-{{ section.id }} .pdw-included-list { margin: 0; padding: 0; list-style: none; color: var(--pdw-body-color); }
    #product-details-{{ section.id }} .pdw-included-list li { display: flex; gap: .6rem; align-items: start; margin: .35rem 0; }
    #product-details-{{ section.id }} .pdw-dot { color: var(--pdw-title-color); }

    #product-details-{{ section.id }} .pdw-card { background: linear-gradient(135deg, var(--pdw-card-grad-start), var(--pdw-card-grad-end)); border-radius: var(--pdw-card-radius); padding: 2rem; box-shadow: var(--pdw-card-shadow); }
    #product-details-{{ section.id }} .pdw-media { background: var(--pdw-media-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; overflow: hidden; }
    #product-details-{{ section.id }} .pdw-img { width: 100%; height: 100%; object-fit: none; }
    #product-details-{{ section.id }} .pdw-emoji { font-size: 3.5rem; }
    #product-details-{{ section.id }} .pdw-card-meta { text-align: center; }
    #product-details-{{ section.id }} .pdw-card-caption { color: var(--pdw-subtitle-color); font-size: var(--fs-caption); margin: 0 0 .25rem; }
    #product-details-{{ section.id }} .pdw-price { color: var(--pdw-price-color); font-weight: 800; font-size: var(--fs-price); margin: 0; }
    #product-details-{{ section.id }} .pdw-shipping { color: var(--pdw-subtitle-color); font-size: var(--fs-ship); margin: .15rem 0 0; }

    /* product CTA */
    #product-details-{{ section.id }} .pdw-cta{
    display:inline-flex; align-items:center; justify-content:center;
    padding: var(--cta-py) var(--cta-px);
    font-size: var(--cta-font-size); font-weight:700; text-decoration:none;
    border-radius: var(--cta-radius);
    background: var(--cta-bg); color: var(--cta-text);
    border: var(--cta-border-width) solid var(--cta-border-color);
    box-shadow: var(--cta-shadow);
    transition: background .2s ease, color .2s ease, filter .2s ease;
    margin: 10px 0;
    }
    #product-details-{{ section.id }}[data-cta-style="outline"] .pdw-cta{
    background: transparent; color: var(--cta-border-color);
    }
    #product-details-{{ section.id }} .pdw-cta:hover{
    background: var(--cta-hover-bg); color: var(--cta-hover-text);
    filter: brightness(.98);
    }
    #product-details-{{ section.id }}[data-cta-style="outline"] .pdw-cta:hover{
    background: color-mix(in oklab, var(--cta-border-color) 10%, transparent);
    }
  </style>
</section>

{% schema %}
{
  "name": "Product details widget",
  "settings": [
    { "type": "select", "id": "width", "label": "Section width", "options": [
      { "value": "container", "label": "Container" },
      { "value": "full", "label": "Full width" }
    ], "default": "container" },

    { "type": "select", "id": "source", "label": "Content source (right card)", "options": [
      { "value": "static", "label": "Static (use fields below)" },
      { "value": "product", "label": "Product (pick a product)" }
    ], "default": "static" },
    { "type": "product", "id": "product", "label": "Product (when source = Product)" },

    { "type": "select", "id": "layout", "label": "Column layout (desktop)", "options": [
    { "value": "text-left", "label": "Text left, product right" },
    { "value": "text-right", "label": "Product left, text right" }
    ], "default": "text-left" },

    { "type": "select", "id": "bg_type", "label": "Background type", "options": [
      { "value": "solid", "label": "Solid" },
      { "value": "gradient", "label": "Gradient" }
    ], "default": "solid" },
    { "type": "color", "id": "bg_solid", "label": "Solid background", "default": "#ffffff" },

    { "type": "select", "id": "grad_type", "label": "Gradient type", "options": [
      { "value": "linear", "label": "Linear" },
      { "value": "radial", "label": "Radial" },
      { "value": "conic", "label": "Conic" }
    ], "default": "linear" },
    { "type": "range", "id": "grad_angle", "label": "Gradient angle (0â€“100 â†’ 0â€“360Â°)", "min": 0, "max": 100, "step": 1, "default": 38, "unit": "%" },
    { "type": "color", "id": "grad_start_color", "label": "Start color", "default": "#f3f4f6" },
    { "type": "range", "id": "grad_start_pos", "label": "Start position (%)", "min": 0, "max": 100, "step": 1, "default": 0 },
    { "type": "color", "id": "grad_end_color", "label": "End color", "default": "#ffffff" },
    { "type": "range", "id": "grad_end_pos", "label": "End position (%)", "min": 0, "max": 100, "step": 1, "default": 100 },

    { "type": "text", "id": "title", "label": "Top title", "default": "Professional Back Support" },
    { "type": "text", "id": "subtitle", "label": "Top subtitle", "default": "Engineered for maximum comfort and support, our back support cushion is the perfect solution for anyone who spends long hours sitting." },

    { "type": "text", "id": "badge_1", "label": "Badge 1 text", "default": "Premium Quality" },
    { "type": "text", "id": "badge_2", "label": "Badge 2 text", "default": "Doctor Recommended" },
    { "type": "color", "id": "badge_bg", "label": "Badge (filled) background", "default": "#e5e7eb" },
    { "type": "color", "id": "badge_text", "label": "Badge (filled) text", "default": "#111827" },

    { "type": "text", "id": "heading", "label": "Left heading", "default": "Transform Your Sitting Experience" },
    { "type": "textarea", "id": "body", "label": "Left body text", "default": "Our back support is designed by ergonomic specialists and recommended by healthcare professionals. It provides targeted lumbar support to reduce pressure on your spine and promote proper posture." },

    { "type": "text", "id": "included_title", "label": "Included title", "default": "What's Included:" },

    { "type": "image_picker", "id": "image", "label": "Static image (when source = Static)" },
    { "type": "text", "id": "image_alt", "label": "Static image alt", "default": "Product image" },
    { "type": "range", "id": "media_height", "label": "Media box height (px)", "min": 160, "max": 520, "step": 4, "default": 320 },

    { "type": "color", "id": "included_bg", "label": "Left included box background", "default": "#f1f5f9" },
    { "type": "color", "id": "media_bg", "label": "Right media box background", "default": "#eef2f7" },

    { "type": "color", "id": "card_grad_start", "label": "Card gradient start", "default": "#f9fafb" },
    { "type": "color", "id": "card_grad_end", "label": "Card gradient end", "default": "#ffffff" },
    { "type": "range", "id": "card_radius", "label": "Card corner radius (px)", "min": 0, "max": 40, "step": 1, "default": 16 },
    { "type": "checkbox", "id": "card_shadow", "label": "Card shadow", "default": true },

    { "type": "text", "id": "card_caption", "label": "Static caption (or product title when source = Product)", "default": "Premium Back Support" },
    { "type": "text", "id": "price", "label": "Static price (or product price when source = Product)", "default": "$49.99" },
    { "type": "text", "id": "shipping_note", "label": "Shipping note", "default": "Free shipping included" },

    { "type": "color", "id": "title_color", "label": "Title/Heading color", "default": "#0f172a" },
    { "type": "color", "id": "subtitle_color", "label": "Subtitle color", "default": "#334155" },
    { "type": "color", "id": "body_color", "label": "Body color", "default": "#475569" },
    { "type": "color", "id": "price_color", "label": "Price color", "default": "#0f172a" },
    { "type": "color", "id": "muted_color", "label": "Muted accents (borders/accents)", "default": "#e5e7eb" },

    /* product CTA */
    { "type": "text", "id": "cta_label", "label": "Static CTA label", "default": "Buy now" },
    { "type": "url", "id": "cta_url", "label": "Static CTA link" },
    { "type": "checkbox", "id": "cta_newtab", "label": "Open static CTA in new tab", "default": false },
    { "type": "color", "id": "cta_bg", "label": "CTA background", "default": "#111827" },
    { "type": "color", "id": "cta_text", "label": "CTA text color", "default": "#ffffff" },
    { "type": "select", "id": "cta_style", "label": "CTA style", "options": [
    { "value": "filled", "label": "Filled" },
    { "value": "outline", "label": "Outline" }
    ], "default": "filled" },
    { "type": "color", "id": "cta_hover_bg", "label": "CTA hover background", "default": "#0a0a0a" },
    { "type": "color", "id": "cta_hover_text", "label": "CTA hover text color", "default": "#ffffff" },
    { "type": "color", "id": "cta_border_color", "label": "CTA border color", "default": "#111827" },
    { "type": "range", "id": "cta_border_width", "label": "CTA border width (px)", "min": 0, "max": 8, "step": 1, "default": 2 },
    { "type": "range", "id": "cta_radius", "label": "CTA corner radius (px)", "min": 0, "max": 40, "step": 1, "default": 40 },
    { "type": "checkbox", "id": "cta_shadow", "label": "CTA shadow", "default": true },
    { "type": "range", "id": "cta_font_size", "label": "CTA font size (px)", "min": 12, "max": 26, "step": 1, "default": 16 },
    { "type": "range", "id": "cta_pad_y", "label": "CTA padding Y (px)", "min": 6, "max": 24, "step": 1, "default": 12 },
    { "type": "range", "id": "cta_pad_x", "label": "CTA padding X (px)", "min": 12, "max": 36, "step": 1, "default": 20 },

    /* font sizes */
    { "type": "range", "id": "title_size", "label": "Top title size (px)", "min": 22, "max": 72, "step": 1, "default": 40 },
    { "type": "range", "id": "subtitle_size", "label": "Top subtitle size (px)", "min": 12, "max": 28, "step": 1, "default": 18 },
    { "type": "range", "id": "heading_size", "label": "Left heading size (px)", "min": 18, "max": 56, "step": 1, "default": 30 },
    { "type": "range", "id": "body_size", "label": "Left body size (px)", "min": 12, "max": 24, "step": 1, "default": 18 },
    { "type": "range", "id": "included_title_size", "label": "Included title size (px)", "min": 12, "max": 28, "step": 1, "default": 16 },
    { "type": "range", "id": "badge_size", "label": "Badge text size (px)", "min": 10, "max": 22, "step": 1, "default": 14 },
    { "type": "range", "id": "card_caption_size", "label": "Card caption size (px)", "min": 10, "max": 22, "step": 1, "default": 14 },
    { "type": "range", "id": "price_size", "label": "Price size (px)", "min": 14, "max": 40, "step": 1, "default": 24 },
    { "type": "range", "id": "shipping_size", "label": "Shipping note size (px)", "min": 10, "max": 20, "step": 1, "default": 12 },
    { "type": "range", "id": "padding_top", "label": "Section padding top", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 60},
    { "type": "range", "id": "padding_bottom", "label": "Section padding bottom", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 60}
  ],
  "blocks": [
    {
      "type": "included",
      "name": "Included item",
      "settings": [
        { "type": "text", "id": "text", "label": "Text", "default": "â€¢ 1x Premium Back Support Cushion" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product details widget",
      "blocks": [
        { "type": "included", "settings": { "text": "â€¢ 1x Premium Back Support Cushion" } },
        { "type": "included", "settings": { "text": "â€¢ 2x Adjustable Attachment Straps" } },
        { "type": "included", "settings": { "text": "â€¢ 1x Washable Cover" } },
        { "type": "included", "settings": { "text": "â€¢ Setup Guide & Care Instructions" } },
        { "type": "included", "settings": { "text": "â€¢ 30-Day Money Back Guarantee" } }
      ]
    }
  ]
}
{% endschema %}
